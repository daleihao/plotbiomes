---
title: "Whittaker biomes - examples"
author: "Valentin Stefan"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: true
    fig_caption: true
---

# Simple example

```{r message = FALSE, fig.align = 'center', fig.width = 18/2.54, fig.height = 10/2.54, fig.cap = 'Simple example of Whittaker biome polygons with ggplot'}

library(plotbiomes)
library(ggplot2)

plot_1 <- ggplot() +
  # add biome polygons
  geom_polygon(data = Whittaker_biomes,
               aes(x    = temp_c,
                   y    = precp_cm,
                   fill = biome),
               # adjust polygon border
               colour = "gray98",
               size   = 1) +
  theme_bw()
plot_1
```

# Add color

## Suggested colors

`Ricklefs_colors` is a predefined vector of colors that comes with `plotbiomes` package. These are  the exact colors from Figure 5.5 in *Ricklefs, R. E. (2008), The economy of nature. W. H. Freeman and Company.* (Chapter 5, Biological Communities, The biome concept)
``` {r}
Ricklefs_colors
```

```{r fig.align = 'center', fig.width = 18/2.54, fig.height = 10/2.54, fig.cap = 'Whittaker biomes - colors as in in Ricklefs (2008)'}

plot_2 <- plot_1 +
  # fill the polygons with predefined colors
  scale_fill_manual(name   = "Whittaker biomes",
                    breaks = names(Ricklefs_colors),
                    labels = names(Ricklefs_colors),
                    values = Ricklefs_colors) +
  theme_bw()
plot_2
```

The same can be achieved with a simple function call (author: [Sam Levin](https://github.com/levisc8)):
```{r eval = FALSE}
whittaker_base_plot() + theme_bw()
```

## Define colors

Of course, if you feel creative, a color palette can be defined with [`RColorBrewer`](https://cran.r-project.org/web/packages/RColorBrewer/index.html) or `grDevices` packages. Try also the [`colorspace`](https://cran.r-project.org/web/packages/colorspace/index.html) package. Or simply pick your favorite 9 colors.

```{r echo = TRUE, message = FALSE, fig.show = 'hold', fig.align = 'center', out.width = '45%', fig.cap = 'Try custom palette'}

library(RColorBrewer)

# the main rule - create 9 colors for the 9 biomes

# failed trial with RColorBrewer :)
my_palette_1 <- rev(brewer.pal(n = 9, name = "BrBG"))
whittaker_base_plot(color_palette = my_palette_1)

# this seems a better approach - interpolate 9 colors from given main 3  
my_palette_2 <- colorRampPalette(colors = c("#F5F5F5",  "#01665E", "#8C510A"))(9)
whittaker_base_plot(color_palette = my_palette_2)
```

The above is just a shorter way of this:
```{r eval=FALSE}

names(my_palette_2) <- names(Ricklefs_colors)

ggplot() +
  # add biome polygons
  geom_polygon(data = Whittaker_biomes,
               aes(x    = temp_c,
                   y    = precp_cm,
                   fill = biome),
               # adjust polygon border
               colour = "gray98",
               size   = 1) +
  # fill the polygons with desired colors
  scale_fill_manual(name   = "Whittaker biomes",
                    breaks = names(Ricklefs_colors),
                    labels = names(Ricklefs_colors),
                    values = my_palette_2) +
  theme_bw()
```

# Add data points

Generate random locations and extract temperature and precipitation from WorldClim data.
```{r, echo = TRUE, message = FALSE}
library(raster)
# Read temperature and precipitation as raster stack
path <- system.file("extdata", "temp_pp.tif", package = "plotbiomes")
temp_pp <- raster::stack(path)
names(temp_pp) <- c("temperature", "precipitation")

set.seed(66) # random number generator
# Create random locations within the bounding box of the raster
points <- sp::spsample(as(temp_pp@extent, 'SpatialPolygons'), 
                       n = 1000, 
                       type = "random")
proj4string(points) <- temp_pp@crs
# Extract temperature and precipitation values from raster
extractions <- raster::extract(temp_pp, points)
extractions <- data.frame(extractions)
# Adjust temperature values to "usual" scale because
# WorldClim temperature data has a scale factor of 10.
extractions$temperature <- extractions$temperature/10
```

Plot the random locations. Note that points outside of rasters coverage will receive NA-s. They will be dropped by ggplot.
```{r, echo = TRUE, message = FALSE, out.width = '45%', fig.align = 'center', fig.cap = 'Extract temperature and precipitation values for 1000 random locations'}
plot(temp_pp[[1]]/10)
plot(points,add=T)
```

Example of plot incorporating extraction data corresponding to the locations.
```{r, echo = TRUE, message = FALSE, fig.align = 'center', fig.width = 18/2.54, fig.height = 10/2.54, fig.cap = 'Example of plot with superimposed data extracted from WorldClim'}
plot_3 <- plot_2 +
  # add the temperature - precipitation points
  geom_point(data = extractions, 
             aes(x = temperature, 
                 y = precipitation/10), 
             size   = 2,
             shape  = 21,
             colour = "Blue 4", 
             bg     = "Deep Sky Blue 4",
             alpha  = 0.6) +
  # set axes label names
  labs(x = expression("Mean annual temperature " (degree*C)),
       y = "Mean annual precipitation (cm)") +
  # set range on OY axis and adjust the distance (gap) from OX axis
  scale_y_continuous(limits = c(-5, round(max(extractions$precipitation/10, 
                                              na.rm = TRUE)/50)*50), 
                     expand = c(0, 0)) +
  theme_bw() +
  theme(panel.grid.minor = element_blank()) # eliminate minor grids

plot_3
```
